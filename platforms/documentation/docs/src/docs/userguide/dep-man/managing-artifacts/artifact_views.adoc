// Copyright (C) 2023 Gradle, Inc.
//
// Licensed under the Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International License.;
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      https://creativecommons.org/licenses/by-nc-sa/4.0/
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

[[artifact_view]]
= Artifact View

Gradle divides dependency resolution into two phases:

1. **Graph resolution**:
- Driven by declared dependencies
- Uses attributes assigned to the configuration

2. **Artifact selection**:
- Based on nodes in the dependency graph
- Matches the variant of each node

By default, artifacts are selected using the same attributes that built the graph (in phase 1).

The `ResolutionResult` represents the output of the graph resolution phase, which focuses solely on the nodes in the dependency graph, not the artifacts (files) they expose.

An `ArtifactView` operates on top of the resolved dependency graph (i.e., `ResolutionResult`).
It queries the graph for specific artifacts, enabling artifact resolution with different attributes.

Think of a configuration's `getFiles()` output as an `ArtifactView` that uses the same attributes as the graph resolution.
However, an explicit `ArtifactView` allows you to resolve artifacts from the graph with different attributes.

== Basic example

This example demonstrates how to use an `ArtifactView` to filter and process specific types of artifacts (like Javadocs) from a dependency configuration:

====
include::sample[dir="snippets/dependencyManagement/artifactViews-simple/kotlin",files="build.gradle.kts[tags=process-javadocs-views]"]
include::sample[dir="snippets/dependencyManagement/artifactViews-simple/groovy",files="build.gradle[tags=process-javadocs-views]"]
====

In this example:

- *1. Custom Configuration*: A new configuration is created and populated with a specific dependency.
- *2. Artifact Filtering*: The task filters artifacts based on the `DocsType.JAVADOC` attribute, ensuring that only Javadoc files are selected.
- *3. Artifact Processing*: Further processing can happen here.

== Use cases

There are several ways to leverage Artifact Views in Gradle:

1. **Lenient Resolution**: Using `artifactView` with `lenient=true` allows you to ignore missing dependencies.
2. **Component Filtering**: Using `artifactView` with `componentFilter` lets you exclude specific dependencies from the results.
3. **Variant Reselection**:
- Normally, an artifact must match both the graph's attributes and the `ArtifactView` attributes.
- With `withVariantReselection`, you can select artifacts from any available variants within a component.

== Variant reselection

Without variant reselection, an `artifactView` only selects among the artifact variants of the resolved graph (e.g., those added through `ConfigurationPublications.variants`).
With reselection, it can select artifacts from adjacent variants as well.

For example, in Jacoco, when we resolve the `codeCoverageResultsConf` configuration, it's set up as a runtime classpath, which means it selects the `runtimeElements` variant for each component in the graph.
The `runtimeElements` variant typically provides a jar artifact, but it may also include sub-variants for additional artifacts like class directories.
These sub-variants can be selected without using artifact reselection.

However, other variants, such as `apiElements` or `sourcesElements`, which provide API dependencies or source files respectively, exist alongside `runtimeElements` as separate graph variants.
To select artifacts from these alternative variants, you need to enable artifact reselection in the artifact view.
This allows you to request artifacts from variants that weren't originally selected during the initial resolution phase.

The `resolveJavadocs` task below is designed to resolve and process Javadoc artifacts associated with the dependencies in the `customConfiguration`:

====
include::sample[dir="snippets/dependencyManagement/artifactViews-simple/kotlin",files="build.gradle.kts[tags=resolve-javadocs-views]"]
include::sample[dir="snippets/dependencyManagement/artifactViews-simple/groovy",files="build.gradle[tags=resolve-javadocs-views]"]
====

In the example:

- *1. Reselection*: With `withVariantReselection()`, Gradle can select alternative variants of components beyond the initial resolution (e.g., from runtime to Javadoc).
- *2. Attribute Filtering*: Filters the artifacts down to Javadocs by using the appropriate attributes.
- *3. Artifact Processing*: Further processing can happen here.
